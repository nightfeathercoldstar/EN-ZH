# PDF 翻译工具项目文档

## 1. 项目概述

### 1.1 项目简介

这是一个基于 FastAPI 开发的 PDF 文档翻译工具，支持将 PDF 文档翻译成多种语言，并能够提取文档中的公式、表格和图片等内容。项目采用现代化的 Web 架构，提供了友好的用户界面和完整的 API 接口。该工具特别适合处理学术论文、技术文档等包含复杂格式的 PDF 文件。

### 1.2 主要功能

- PDF 文档上传和本地路径导入
  - 支持拖拽上传
  - 支持本地文件路径输入
  - 支持批量文件处理
- 多语言翻译支持
  - 支持中英文互译
  - 支持其他主要语言
  - 保持原文格式
- 公式提取和识别
  - LaTeX 公式识别
  - 数学公式转换
  - 公式图片保存
- 表格提取和转换
  - 表格结构保持
  - Excel 格式导出
  - 表格样式保留
- 图片提取和保存
  - 高清图片提取
  - 批量图片处理
  - 图片格式转换
- 结果导出和下载
  - Markdown 格式导出
  - 压缩包下载
  - 在线预览

### 1.3 技术栈

- 后端框架：FastAPI
  - 异步处理支持
  - 自动 API 文档生成
  - 高性能请求处理
- PDF 处理：PyMuPDF (fitz)、pdfplumber
  - 文本提取
  - 图片处理
  - 表格识别
- 翻译服务：OpenAI GPT-4
  - 高质量翻译
  - 上下文理解
  - 专业术语处理
- 前端模板：Jinja2
  - 响应式设计
  - 动态内容渲染
  - 模板继承
- 数据处理：pandas
  - 表格数据处理
  - 数据格式转换
  - 数据导出
- 文件处理：Python 标准库
  - 文件 IO 操作
  - 路径处理
  - 压缩解压

## 2. 系统架构

### 2.1 整体架构

项目采用前后端分离的架构设计：

- 前端：基于 HTML/CSS/JavaScript 的 Web 界面
  - 响应式布局
  - 异步请求处理
  - 实时状态更新
- 后端：FastAPI RESTful API 服务
  - 异步处理
  - 中间件支持
  - 错误处理
- 文件存储：本地文件系统
  - 临时文件管理
  - 结果文件存储
  - 文件清理机制
- 翻译服务：OpenAI API 集成
  - API 密钥管理
  - 请求限流
  - 错误重试

### 2.2 目录结构

```
project/
├── static/              # 静态资源文件
│   ├── css/            # 样式文件
│   │   ├── main.css    # 主样式文件
│   │   └── themes/     # 主题样式
│   └── js/             # JavaScript文件
│       ├── main.js     # 主脚本文件
│       └── utils/      # 工具函数
├── templates/          # HTML模板文件
│   ├── base.html      # 基础模板
│   └── index.html     # 主页模板
├── pdf_store/         # PDF文件存储目录
├── result/            # 处理结果存储目录
│   └── img_result/    # 提取的图片存储目录
├── temp_images/       # 临时图片存储目录
├── interface.py       # FastAPI接口实现
├── pdfprocessor.py    # PDF处理核心逻辑
├── pdfinput.py        # PDF输入处理
├── pdfformulaget.py   # 公式提取处理
├── pdffindformula.py  # 公式查找处理
├── requirements.txt   # 项目依赖
└── config.py         # 配置文件
```

## 3. 核心功能模块

### 3.1 PDF 处理模块 (pdfprocessor.py)

- 文件清理和初始化
  - 临时文件清理
  - 结果目录初始化
  - 权限检查
- PDF 文本提取
  - 文本内容提取
  - 格式保持
  - 编码处理
- 图片提取和保存
  - 图片识别
  - 格式转换
  - 质量优化
- 表格提取和转换
  - 表格结构识别
  - 数据提取
  - Excel 导出
- 文本翻译处理
  - 分段处理
  - 上下文保持
  - 专业术语处理

### 3.2 API 接口模块 (interface.py)

- 文件上传接口
  - 文件验证
  - 大小限制
  - 类型检查
- 翻译处理接口
  - 异步处理
  - 进度跟踪
  - 错误处理
- 结果查询接口
  - 状态查询
  - 结果获取
  - 缓存处理
- 文件下载接口
  - 文件打包
  - 流式下载
  - 断点续传
- 状态查询接口
  - 处理进度
  - 错误信息
  - 系统状态

### 3.3 公式处理模块 (pdfformulaget.py, pdffindformula.py)

- 公式识别和提取
  - LaTeX 识别
  - 数学公式提取
  - 公式验证
- 公式图片处理
  - 图片提取
  - 格式转换
  - 质量优化
- 公式文本转换
  - LaTeX 转换
  - 格式保持
  - 特殊字符处理

## 4. API 接口说明

### 4.1 主要接口

1. `GET /` - 主页接口
   - 返回主页 HTML
   - 提供基本使用说明
2. `POST /upload-pdf/` - PDF 文件上传
   - 支持文件上传
   - 返回文件信息
3. `POST /validate-pdf-path/` - PDF 路径验证
   - 验证本地路径
   - 检查文件有效性
4. `POST /translate-pdf/` - PDF 翻译处理
   - 异步处理请求
   - 返回处理状态
5. `GET /pdf-list/` - 获取 PDF 文件列表
   - 返回文件列表
   - 包含文件信息
6. `GET /results/` - 获取处理结果
   - 返回处理结果
   - 包含各种格式
7. `GET /download-results/{filename}` - 下载结果文件
   - 支持文件下载
   - 支持断点续传

### 4.2 请求/响应格式

#### 文件上传请求

```json
{
  "file": "binary_data",
  "filename": "example.pdf"
}
```

#### 翻译请求

```json
{
  "file_path": "/path/to/file.pdf",
  "target_language": "zh",
  "use_local_path": true
}
```

#### 响应格式

```json
{
  "status": "success",
  "message": "处理完成",
  "data": {
    "text": "翻译后的文本",
    "formulas": "提取的公式",
    "tables": "表格数据"
  }
}
```

## 5. 部署说明

### 5.1 环境要求

- Python 3.8+
  - 异步支持
  - 类型注解
  - 新特性支持
- 依赖包（见 requirements.txt）
  - FastAPI
  - PyMuPDF
  - pdfplumber
  - pandas
  - openai
- OpenAI API 密钥
  - 有效的 API 密钥
  - 足够的配额
- 代理设置（如需要）
  - HTTP 代理
  - HTTPS 代理

### 5.2 安装步骤

1. 克隆项目代码
   ```bash
   git clone https://github.com/your-repo/pdf-translator.git
   cd pdf-translator
   ```
2. 安装依赖
   ```bash
   pip install -r requirements.txt
   ```
3. 配置环境变量
   ```bash
   export OPENAI_API_KEY="your-api-key"
   export OPENAI_API_BASE="https://api.openai-proxy.org/v1"
   ```
4. 启动服务
   ```bash
   python interface.py
   ```

### 5.3 配置说明

- OpenAI API 配置
  - API 密钥设置
  - 代理设置
  - 模型选择
- 代理设置
  - HTTP 代理
  - HTTPS 代理
  - 认证信息
- 文件存储路径配置
  - 临时文件目录
  - 结果文件目录
  - 权限设置
- 语言支持配置
  - 支持的语言列表
  - 语言代码映射
  - 翻译模型选择

## 6. 使用说明

### 6.1 基本使用流程

1. 访问主页
   - 打开浏览器
   - 访问服务地址
2. 上传 PDF 文件或提供本地路径
   - 拖拽上传
   - 选择文件
   - 输入路径
3. 选择目标语言
   - 选择语言
   - 设置选项
4. 等待处理完成
   - 查看进度
   - 等待结果
5. 下载处理结果
   - 选择格式
   - 下载文件

### 6.2 结果文件说明

- translated_result.md
  - 翻译后的文本
  - Markdown 格式
  - 保持格式
- formula_result.md
  - 提取的公式
  - LaTeX 格式
  - 数学公式
- table_result.xlsx
  - 提取的表格
  - Excel 格式
  - 保持结构
- img_result/
  - 提取的图片
  - 原始格式
  - 高清质量

## 7. 开发指南

### 7.1 代码规范

- 遵循 PEP 8 规范
  - 命名规范
  - 注释规范
  - 格式规范
- 使用类型注解
  - 函数参数
  - 返回值
  - 变量类型
- 编写详细的注释
  - 函数说明
  - 参数说明
  - 返回值说明
- 模块化设计
  - 功能分离
  - 接口定义
  - 依赖管理

### 7.2 扩展开发

- 添加新的语言支持
  - 语言模型
  - 翻译规则
  - 特殊处理
- 优化翻译质量
  - 上下文处理
  - 专业术语
  - 格式保持
- 改进公式识别
  - 识别算法
  - 格式转换
  - 验证机制
- 增强表格处理
  - 结构识别
  - 数据提取
  - 格式转换

## 8. 注意事项

### 8.1 性能考虑

- 大文件处理
  - 分块处理
  - 内存优化
  - 进度跟踪
- 并发请求处理
  - 请求队列
  - 资源限制
  - 超时处理
- 内存使用优化
  - 垃圾回收
  - 资源释放
  - 缓存管理
- 临时文件清理
  - 自动清理
  - 定期维护
  - 空间管理

### 8.2 安全考虑

- 文件上传验证
  - 类型检查
  - 大小限制
  - 内容验证
- API 访问控制
  - 认证机制
  - 权限控制
  - 请求限制
- 敏感信息保护
  - 密钥管理
  - 数据加密
  - 日志处理
- 错误处理机制
  - 异常捕获
  - 错误日志
  - 恢复机制

## 9. 常见问题

### 9.1 故障排除

- 文件上传失败
  - 检查文件大小
  - 验证文件格式
  - 检查权限
- 翻译服务异常
  - 检查 API 密钥
  - 验证网络连接
  - 查看错误日志
- 公式识别问题
  - 检查图片质量
  - 验证识别算法
  - 调整参数
- 结果导出错误
  - 检查文件权限
  - 验证磁盘空间
  - 查看错误日志

### 9.2 使用建议

- 文件大小限制
  - 建议小于 50MB
  - 分块处理
  - 压缩处理
- 支持的文件格式
  - PDF 格式
  - 图片格式
  - 文本格式
- 最佳实践指南
  - 文件准备
  - 参数设置
  - 结果处理
- 性能优化建议
  - 资源使用
  - 并发处理
  - 缓存策略

## 10. 更新日志

### 10.1 版本历史

- v1.0.0：初始版本
  - 基础 PDF 处理功能
  - 多语言翻译支持
  - 公式和表格提取
  - Web 界面实现
- v1.1.0：功能增强
  - 批量处理支持
  - 更多语言支持
  - 性能优化
  - 界面改进

### 10.2 计划更新

- 批量处理功能
  - 队列管理
  - 进度跟踪
  - 结果合并
- 更多语言支持
  - 新增语言
  - 翻译优化
  - 本地化支持
- 界面优化
  - 响应式设计
  - 用户体验
  - 主题支持
- 性能提升
  - 并发处理
  - 缓存优化
  - 资源管理

## 11. 贡献指南

### 11.1 如何贡献

- 提交 Issue
  - 问题描述
  - 复现步骤
  - 环境信息
- 提交 Pull Request
  - 代码规范
  - 测试覆盖
  - 文档更新
- 代码审查
  - 功能验证
  - 性能测试
  - 安全检查
- 文档更新
  - 使用说明
  - API 文档
  - 示例代码

### 11.2 开发流程

- 分支管理
  - 主分支
  - 开发分支
  - 特性分支
- 版本控制
  - 提交规范
  - 版本号
  - 更新日志
- 测试要求
  - 单元测试
  - 集成测试
  - 性能测试
- 发布流程
  - 版本打包
  - 文档更新
  - 发布公告

## 12. 许可证

本项目采用 MIT 许可证。详见 LICENSE 文件。

### 12.1 许可证说明

- 允许商业使用
- 允许修改
- 允许分发
- 允许私有使用

### 12.2 免责声明

- 不保证可用性
- 不保证正确性
- 不保证安全性
- 不承担任何责任
